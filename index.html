<!DOCTYPE html>
<html lang="en">
<head>
    <!-- 헤더 부분은 변경 없음 -->
</head>
<body>
    <!-- 바디의 HTML 부분은 변경 없음 -->

    <script>
        // 기존 변수 선언 부분은 변경 없음

        // connectMicrobit, readLoop, loadModel 함수는 변경 없음

        function toggleInput() {
            const cameraInput = document.getElementById('cameraInput');
            const webcamContainer = document.getElementById('webcam-container');
            const imageUploadContainer = document.getElementById('image-upload-container');

            if (cameraInput.checked) {
                webcamContainer.style.display = 'block';
                imageUploadContainer.style.display = 'none';
                if (!isWebcamActive) {
                    setupWebcam();
                }
            } else {
                webcamContainer.style.display = 'none';
                imageUploadContainer.style.display = 'block';
                if (isWebcamActive) {
                    stopWebcam();
                }
            }
        }

        async function setupWebcam() {
            const webcamContainer = document.getElementById("webcam-container");
            webcamContainer.innerHTML = ''; // 기존 내용 삭제

            const flip = true;
            webcam = new tmImage.Webcam(200, 200, flip);
            await webcam.setup();
            await webcam.play();
            isWebcamActive = true;
            window.requestAnimationFrame(loop);

            webcamContainer.appendChild(webcam.canvas);
            addDebugMessage('Webcam setup complete');
        }

        function stopWebcam() {
            if (webcam) {
                webcam.stop();
                isWebcamActive = false;
                addDebugMessage('Webcam stopped');
            }
        }

        // loop, predict, classifyUploadedImage 함수는 변경 없음

        async function sendToMicrobit(className) {
            if (writer) {
                try {
                    const data = className + '\n';  // "C" 접두사 제거
                    addDebugMessage('Attempting to send: ' + data);
                    await writer.write(encoder.encode(data));
                    console.log('Sent to Microbit:', data);
                    addDebugMessage('Successfully sent to Microbit: ' + data);
                } catch (error) {
                    console.error('Send error:', error);
                    addDebugMessage('Send error: ' + error.message);
                    await reconnectMicrobit();
                }
            } else {
                addDebugMessage('Writer not available. Reconnecting...');
                await reconnectMicrobit();
            }
        }

        // reconnectMicrobit 함수는 변경 없음
    </script>
</body>
</html>
